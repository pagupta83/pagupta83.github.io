<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Dialog Element</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      window.loginWindow;
      var counter=0;
      $(document).ready(function () {
        async function play(wnd) {
          console.log("hi");
          let response = await fetch(
            "https://eiiv-dev1.fa.us6.oraclecloud.com/fscmRestApi/anticsrf"
          );
          console.log(response.status);
          let data = await response.json();
          console.log("csrf: " + data.xsrftoken);
          let tokenResponse = await fetch("https://eiiv-dev1.fa.us6.oraclecloud.com/fscmRestApi/tokenrelay?format=json",
                 {"X-XSRF-TOKEN": data.xsrftoken,"mode": 'no-cors'});
          //let tokenData = await tokenResponse.json();
          //console.log("token: "+ tokenData.accessToken);
          counter=counter+1;
          if (counter===3){
            loginWindow.close();
          }                
        }
        window.addEventListener("focus", function(){
          play();
           }
          );
        $("button").click(function () {
          window
            .open(
              'https://eiiv-dev1.fa.us6.oraclecloud.com/fscmUI/faces/FuseWelcome',
              'ModalPopUp',
              'location=no,height=570,width=520,scrollbars=no,status=no',
              (win) =>{
                console.log("wind : "+win);
              }
            )
            .focus();
            console.log("window: " + typeof loginWindow);
        });
      });
    </script>
  </head>
  <body>
    <button id="openModalDialog">Open Modal Dialog</button>
  </body>
  http://app.js
</html>
