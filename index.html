<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Dialog Element</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      var loginWindow;
      var counter=0;
      $(document).ready(function () {
        async function play(wnd) {
          console.log("hi");
          let response = await fetch(
            "https://eiiv-dev1.fa.us6.oraclecloud.com/fscmRestApi/anticsrf"
          );
          console.log(response.status);
          let data = await response.json();
          console.log("csrf: " + data.xsrftoken);
          let tokenResponse = await fetch("https://eiiv-dev1.fa.us6.oraclecloud.com/fscmRestApi/tokenrelay?format=json",
                 {method: "GET", 
                  headers: {'X-XSRF-TOKEN': data.xsrftoken,
                            'Access-Control-Allow-Origin':'https://pagupta83.github.io'
                           }
                 });
          let tokenData = await tokenResponse.json();
          console.log("token status "+tokenResponse.status);
          console.log("tokenData "+tokenData);
          console.log("accessToken: "+ json.stringify(tokenData));
          counter=counter+1;
          if (counter===3){
            loginWindow.close();
          }                
        }
        window.addEventListener("focus", function(){
          play();
           }
          );
        $("button").click(function () {
          loginWindow=window.open(
              "https://eiiv-dev1.fa.us6.oraclecloud.com/fscmUI/faces/FuseWelcome",
              "ModalPopUp","location=no");
            loginWindow.focus();
            console.log("window: " + typeof loginWindow);
        });
      });
    </script>
  </head>
  <body>
    <button id="openModalDialog">Open Modal Dialog</button>
  </body>
  http://app.js
</html>
